<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tempbox — Multi Email</title>
    <meta name="description" content="Generate email sementara gratis. Terima verifikasi tanpa daftar akun.">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Instrument+Serif:ital@0;1&family=DM+Mono:ital,wght@0,400;0,500;1,400&family=DM+Sans:wght@400;500;600&display=swap"
        rel="stylesheet">

    <style>
        :root {
            --ink: #1c1612;
            --ink2: #5a4e44;
            --ink3: #9e9187;
            --ink4: #c8bfb5;
            --paper: #f5f0ea;
            --paper2: #ede7df;
            --paper3: #e2d9ce;
            --cream: #faf7f3;
            --line: rgba(28, 22, 18, 0.08);
            --amber: #bf6c22;
            --amber-lt: rgba(191, 108, 34, 0.10);
            --amber-br: rgba(191, 108, 34, 0.25);
            --green: #3a6b4a;
            --green-lt: rgba(58, 107, 74, 0.10);
            --green-br: rgba(58, 107, 74, 0.22);
            --red: #8b2e2e;
            --red-lt: rgba(139, 46, 46, 0.08);
            --serif: 'Instrument Serif', Georgia, serif;
            --mono: 'DM Mono', monospace;
            --sans: 'DM Sans', sans-serif;
        }

        *,
        *::before,
        *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: var(--sans);
            background: var(--paper);
            color: var(--ink);
            min-height: 100vh;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            inset: 0;
            pointer-events: none;
            z-index: 999;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.025'/%3E%3C/svg%3E");
            opacity: 0.5;
        }

        .topbar {
            position: sticky;
            top: 0;
            z-index: 100;
            height: 52px;
            background: var(--cream);
            border-bottom: 1px solid var(--line);
            display: flex;
            align-items: center;
        }

        .topbar-inner {
            max-width: 700px;
            margin: 0 auto;
            padding: 0 24px;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .logo-word {
            font-family: var(--serif);
            font-size: 19px;
            letter-spacing: -0.02em;
        }

        .topbar-link {
            font-size: 12.5px;
            font-weight: 500;
            color: var(--ink3);
            padding: 5px 10px;
            border-radius: 5px;
            transition: all 0.15s;
            text-decoration: none;
        }

        .topbar-link:hover {
            background: var(--paper2);
            color: var(--ink);
        }

        .page {
            max-width: 700px;
            margin: 0 auto;
            padding: 40px 24px 80px;
        }

        .masthead {
            display: flex;
            align-items: flex-end;
            justify-content: space-between;
            gap: 16px;
            margin-bottom: 28px;
            animation: fadeUp 0.5s ease both;
        }

        .headline {
            font-family: var(--serif);
            font-size: clamp(28px, 5.5vw, 40px);
            line-height: 1.12;
            letter-spacing: -0.02em;
        }

        .headline em {
            font-style: italic;
            color: var(--amber);
        }

        .sub {
            margin-top: 9px;
            font-size: 13px;
            color: var(--ink3);
            max-width: 320px;
            line-height: 1.65;
        }

        /* ── TABS ── */
        .tabs-container {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
            overflow-x: auto;
            padding-bottom: 4px;
            -webkit-overflow-scrolling: touch;
        }

        .email-tab {
            padding: 8px 14px;
            background: var(--cream);
            border: 1px solid var(--line);
            border-radius: 10px;
            font-family: var(--mono);
            font-size: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            white-space: nowrap;
            transition: all 0.2s;
            user-select: none;
        }

        .email-tab.active {
            background: var(--amber);
            color: white;
            border-color: var(--amber);
            box-shadow: 0 4px 10px rgba(191, 108, 34, 0.2);
        }

        .email-tab button {
            background: none;
            border: none;
            color: inherit;
            font-size: 14px;
            cursor: pointer;
            opacity: 0.5;
            padding: 0 2px;
        }

        .panel {
            background: var(--cream);
            border: 1px solid var(--line);
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 14px;
        }

        .panel-sec {
            padding: 20px 22px;
        }

        .chip {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            font-family: var(--mono);
            font-size: 9.5px;
            font-weight: 500;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            color: var(--ink3);
            margin-bottom: 13px;
        }

        .cdot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: var(--ink4);
        }

        .cdot.live {
            background: var(--green);
        }

        .email-box {
            display: flex;
            align-items: center;
            gap: 8px;
            background: var(--paper2);
            border: 1px solid var(--line);
            border-radius: 8px;
            padding: 12px 14px;
            margin-bottom: 13px;
        }

        .email-val {
            flex: 1;
            min-width: 0;
            font-family: var(--mono);
            font-size: 13.5px;
            font-weight: 500;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .email-val.ph {
            color: var(--ink4);
            font-family: var(--sans);
            font-size: 13px;
            font-style: italic;
        }

        .ibtn {
            width: 32px;
            height: 32px;
            border-radius: 6px;
            border: 1px solid var(--line);
            background: var(--cream);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.15s;
            color: var(--ink3);
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 7px;
            padding: 10px 20px;
            border-radius: 7px;
            border: none;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.15s;
        }

        .btn-main {
            flex: 1;
            background: var(--amber);
            color: white;
        }

        .btn-main:hover:not(:disabled) {
            background: #a55d1b;
            transform: translateY(-1px);
        }

        .btn-ghost {
            background: var(--paper2);
            color: var(--ink2);
            border: 1px solid var(--line);
        }

        .inbox-head {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 14px 22px;
            border-bottom: 1px solid var(--line);
            background: var(--paper);
        }

        .mbadge {
            font-family: var(--mono);
            font-size: 10px;
            background: var(--amber-lt);
            color: var(--amber);
            padding: 2px 8px;
            border-radius: 4px;
        }

        #msg-list {
            padding: 16px;
        }

        .istate {
            padding: 48px 20px;
            text-align: center;
            color: var(--ink3);
            font-size: 13px;
        }

        .mcard {
            background: var(--paper);
            border: 1px solid var(--line);
            border-radius: 8px;
            margin-bottom: 8px;
            overflow: hidden;
        }

        .mtop {
            padding: 13px 16px;
            cursor: pointer;
            display: flex;
            gap: 12px;
        }

        .mavatar {
            width: 34px;
            height: 34px;
            border-radius: 50%;
            background: var(--paper3);
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: var(--serif);
            color: var(--amber);
        }

        .mbody {
            display: none;
            padding: 14px 16px;
            border-top: 1px solid var(--line);
            font-family: var(--mono);
            font-size: 12.5px;
            background: var(--paper2);
            white-space: pre-wrap;
        }

        .mbody.open {
            display: block;
        }

        /* ── MODALS & TOAST ── */
        .modal-overlay {
            display: none;
            position: fixed;
            inset: 0;
            z-index: 9999;
            align-items: center;
            justify-content: center;
            padding: 20px;
            background: rgba(28, 22, 18, 0.4);
            backdrop-filter: blur(2px);
            opacity: 0;
            transition: opacity 0.2s;
        }

        .modal-card {
            background: var(--cream);
            padding: 24px;
            border-radius: 12px;
            max-width: 400px;
            width: 100%;
            border: 1px solid var(--line);
            transform: translateY(10px);
            transition: transform 0.2s;
        }

        .toast {
            position: fixed;
            bottom: 24px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: var(--ink);
            color: var(--paper);
            padding: 10px 20px;
            border-radius: 50px;
            font-size: 12px;
            font-weight: 500;
            z-index: 10000;
            transition: transform 0.3s cubic-bezier(0.18, 0.89, 0.32, 1.28);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
        }

        .toast.show {
            transform: translateX(-50%) translateY(0);
        }

        @keyframes fadeUp {
            from {
                opacity: 0;
                transform: translateY(14px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @media (max-width: 500px) {
            .counter-wrap {
                display: none;
            }
        }
    </style>
</head>

<body>

    <header class="topbar">
        <div class="topbar-inner">
            <div class="logo"><span class="logo-word">Tempbox</span></div>
            <a href="/docs.html" class="topbar-link">Docs</a>
        </div>
    </header>

    <main class="page">
        <div class="masthead">
            <div>
                <h1 class="headline">Email <em>multi-sesi,</em><br>sekali klik.</h1>
                <p class="sub">Gratis dan privasi aman.</p>
            </div>
            <div class="counter-wrap" style="text-align:right">
                <span id="stat-count"
                    style="font-family:var(--serif); font-size:44px; display:block; line-height:1">0</span>
                <span style="font-family:var(--mono); font-size:9px; color:var(--ink3); text-transform:uppercase">total
                    pesan</span>
            </div>
        </div>

        <div id="email-tabs" class="tabs-container"></div>

        <div class="panel">
            <div class="panel-sec">
                <div class="chip">
                    <div class="cdot" id="cdot"></div>
                    <span id="ctext">Belum aktif</span>
                </div>
                <div class="email-box">
                    <span class="email-val ph" id="email-val">Klik Generate untuk mulai...</span>
                    <button class="ibtn" onclick="copyEmail()" id="btn-copy">⎘</button>
                </div>
                <div class="brow">
                    <button class="btn btn-main" id="btn-gen" onclick="doGenerate()">Generate Email Baru</button>
                </div>
            </div>
        </div>

        <div class="panel">
            <div class="inbox-head">
                <div style="display:flex; align-items:center; gap:10px">
                    <span style="font-family:var(--serif); font-size:17px;">Inbox</span>
                    <span class="mbadge" id="mbadge">0 pesan</span>
                </div>
                <button class="btn btn-ghost" id="btn-ref" onclick="doRefresh()"
                    style="padding:7px 13px; font-size:12px">Refresh</button>
            </div>
            <div id="uprow"
                style="display:none; padding:8px 22px; background:var(--paper2); font-size:11px; color:var(--ink3); border-bottom:1px solid var(--line)">
                <span id="uptext"></span>
            </div>
            <div id="msg-list">
                <div class="istate">Silakan pilih atau generate email untuk melihat inbox.</div>
            </div>
        </div>
    </main>

    <div id="modal-overlay" class="modal-overlay">
        <div class="modal-card">
            <div id="modal-title" style="font-family:var(--serif); font-size:20px; margin-bottom:8px"></div>
            <div id="modal-msg" style="font-size:14px; color:var(--ink2); margin-bottom:20px; line-height:1.5"></div>
            <div id="modal-actions" style="display:flex; gap:8px;"></div>
        </div>
    </div>

    <div id="toast" class="toast">Email berhasil disalin!</div>

    <script>
        let emails = [];
        let activeIdx = -1;

        window.addEventListener('DOMContentLoaded', () => {
            const saved = JSON.parse(localStorage.getItem('tb_emails') || '[]');
            if (saved.length > 0) {
                emails = saved;
                renderTabs();
                selectEmail(0);
            }
        });

        function renderTabs() {
            const container = document.getElementById('email-tabs');
            container.innerHTML = '';
            emails.forEach((em, i) => {
                const tab = document.createElement('div');
                tab.className = `email-tab ${i === activeIdx ? 'active' : ''}`;
                tab.innerHTML = `<span>${em.address.split('@')[0]}</span><button onclick="confirmRemove(${i}, event)">✕</button>`;
                tab.onclick = () => selectEmail(i);
                container.appendChild(tab);
            });
            document.getElementById('btn-gen').disabled = emails.length >= 5;
            document.getElementById('stat-count').textContent = emails.reduce((acc, curr) => acc + (curr.inbox?.length || 0), 0);
        }

        function selectEmail(idx) {
            activeIdx = idx;
            const current = emails[idx];
            if (!current) return;
            document.getElementById('email-val').textContent = current.address;
            document.getElementById('email-val').classList.remove('ph');
            document.getElementById('mbadge').textContent = (current.inbox?.length || 0) + ' pesan';
            applyMeta(current.status, current.uptime);
            renderMsgs(current.inbox || []);
            renderTabs();
        }

        async function doGenerate() {
            if (emails.length >= 5) return;
            const btn = document.getElementById('btn-gen');
            btn.textContent = 'Generating...';
            try {
                const r = await fetch('/api/generate');
                const d = await r.json();
                if (d.success) {
                    emails.push({ address: d.result.email, status: d.result.emailStatus, uptime: d.result.uptime, inbox: [] });
                    saveData();
                    selectEmail(emails.length - 1);
                }
            } catch (e) { showModal('Error', 'Gagal koneksi server'); }
            btn.innerHTML = 'Generate Email Baru';
        }

        async function doRefresh() {
            if (activeIdx === -1) return;
            const btn = document.getElementById('btn-ref');
            btn.textContent = 'Updating...';
            try {
                const r = await fetch(`/api/inbox?email=${encodeURIComponent(emails[activeIdx].address)}`);
                const d = await r.json();
                if (d.success) {
                    emails[activeIdx].inbox = d.result.inbox || [];
                    emails[activeIdx].status = d.result.emailStatus;
                    emails[activeIdx].uptime = d.result.uptime;
                    saveData();
                    selectEmail(activeIdx);
                }
            } catch (e) { showModal('Error', 'Refresh gagal'); }
            btn.textContent = 'Refresh';
        }

        function confirmRemove(idx, e) {
            e.stopPropagation();
            showModal('Hapus Email?', `Apakah Anda yakin ingin menghapus <b>${emails[idx].address}</b>? Sesi inbox akan hilang.`, [
                { label: 'Batal', type: 'ghost', action: closeModal },
                { label: 'Hapus', type: 'main', action: () => { removeEmail(idx); closeModal(); }, style: 'background:var(--red)' }
            ]);
        }

        function removeEmail(idx) {
            emails.splice(idx, 1);
            activeIdx = emails.length > 0 ? 0 : -1;
            saveData();
            if (activeIdx !== -1) selectEmail(0);
            else location.reload();
        }

        function renderMsgs(msgs) {
            const list = document.getElementById('msg-list');
            if (msgs.length === 0) {
                list.innerHTML = '<div class="istate">Belum ada pesan masuk.</div>';
                return;
            }
            list.innerHTML = '';
            msgs.forEach(m => {
                const card = document.createElement('div');
                card.className = 'mcard';
                card.innerHTML = `<div class="mtop" onclick="this.nextElementSibling.classList.toggle('open')"><div class="mavatar">${(m.from || '?')[0].toUpperCase()}</div><div style="flex:1"><div style="font-size:13px;font-weight:600;margin-bottom:2px">${esc(m.subject)}</div><div style="font-family:var(--mono);font-size:10.5px;color:var(--ink3)">${esc(m.from)}</div></div></div><div class="mbody">${esc(m.message)}</div>`;
                list.appendChild(card);
            });
        }

        function applyMeta(status, uptime) {
            document.getElementById('cdot').className = 'cdot ' + (status === 'good' ? 'live' : '');
            document.getElementById('ctext').textContent = status === 'good' ? 'Aktif' : 'Status: ' + status;
            const upRow = document.getElementById('uprow');
            if (uptime) {
                upRow.style.display = 'block';
                const h = Math.floor(uptime / 60);
                const m = uptime % 60;
                document.getElementById('uptext').textContent = `Domain Uptime: ${h > 0 ? h + 'j ' : ''}${m}m`;
            }
        }

        function saveData() { localStorage.setItem('tb_emails', JSON.stringify(emails)); }

        function copyEmail() {
            const txt = document.getElementById('email-val').textContent;
            if (!txt || txt.includes('Klik')) return;
            navigator.clipboard.writeText(txt);
            const toast = document.getElementById('toast');
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 2500);
        }

        function esc(s) { const d = document.createElement('div'); d.textContent = s; return d.innerHTML; }

        function showModal(title, msg, actions = [{ label: 'Oke', type: 'main', action: closeModal }]) {
            const overlay = document.getElementById('modal-overlay');
            document.getElementById('modal-title').innerHTML = title;
            document.getElementById('modal-msg').innerHTML = msg;
            const actionContainer = document.getElementById('modal-actions');
            actionContainer.innerHTML = '';
            actions.forEach(btn => {
                const b = document.createElement('button');
                b.className = `btn btn-${btn.type}`;
                b.textContent = btn.label;
                if (btn.style) b.style = btn.style;
                b.onclick = btn.action;
                actionContainer.appendChild(b);
            });
            overlay.style.display = 'flex';
            setTimeout(() => { overlay.style.opacity = '1'; overlay.firstElementChild.style.transform = 'translateY(0)'; }, 10);
        }

        function closeModal() {
            const overlay = document.getElementById('modal-overlay');
            overlay.style.opacity = '0';
            overlay.firstElementChild.style.transform = 'translateY(10px)';
            setTimeout(() => overlay.style.display = 'none', 200);
        }
    </script>
</body>

</html>